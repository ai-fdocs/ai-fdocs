# ADR-0001: Default docs source strategy

- **Date:** 2026-02-11
- **Status:** Accepted
- **Decision owners:** npm-ai-fdocs maintainers
- **Related roadmap item:** Milestone C (Source strategy decision)

## Context

В `npm-ai-fdocs` исторически использовались два подхода к получению документации:

1. `github`: читать docs из репозитория пакета;
2. `npm_tarball`: читать docs из опубликованного npm tarball.

Поддержка двух режимов в качестве равноправных primary-стратегий увеличивает архитектурную сложность, количество edge-cases и стоимость поддержки.

С точки зрения single-source подхода, нужен явный default, который:
- предсказуем в CI;
- совместим с опубликованным артефактом пакета;
- не ломает существующие конфиги и пайплайны.

## Decision criteria

При выборе default-источника использовались критерии:

1. **Coverage**
   - насколько часто источник реально содержит полезные docs для package release.
2. **Стабильность**
   - устойчивость к внешним ошибкам (rate limit, auth, недоступность источника),
   - предсказуемость результата для одинакового входа.
3. **Скорость**
   - среднее время sync,
   - накладные расходы на дополнительные запросы и fallback-ветки.

## Decision

Принято решение использовать **`npm_tarball` как default**.

Режим `github` сохраняется как совместимый и настраиваемый (включая fallback-сценарии), но не является default-путём.

## Consequences

### Migration

- Для новых установок миграция не требуется: default уже фиксирован как `npm_tarball`.
- Для существующих проектов с явным `docs_source = "github"` поведение не меняется.
- Для legacy-конфига с `experimental_npm_tarball` сохраняется обратная совместимость.

### Backward compatibility

- Никаких breaking changes в формате конфига не вводится.
- Поддержка `github` режима остаётся доступной как явная настройка.

### Risks

- Для части пакетов coverage в tarball может быть ниже, чем в GitHub-репозитории.
- Возможна потеря некоторых «вне релиза» docs-файлов, если они не входят в publish-артефакт.
- Для снижения риска сохраняются fallback-механизмы и best-effort обработка ошибок в `sync`.
